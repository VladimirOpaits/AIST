# RAG Frontend Architecture

## Обзор архитектуры

Приложение построено на React + Vite + TypeScript с использованием Tailwind CSS и shadcn/ui компонентов.

## Структура проекта

```
src/
├── api/                    # API слой
│   └── ragApi.ts          # Все вызовы к FastAPI backend
├── components/            # React компоненты
│   ├── ui/               # Базовые UI компоненты (shadcn)
│   ├── layout/           # Компоненты макета
│   │   └── AppSidebar.tsx
│   ├── documents/        # Компоненты для работы с документами
│   │   ├── DocumentUpload.tsx
│   │   ├── DocumentCard.tsx
│   │   └── DocumentList.tsx
│   ├── chunks/          # Компоненты для работы с чанками
│   │   └── ChunkCard.tsx
│   └── query/           # Компоненты для запросов
│       ├── QueryInterface.tsx
│       ├── QueryResults.tsx
│       └── SourceNode.tsx
├── hooks/               # Custom React hooks
│   ├── useDocuments.ts # Управление документами
│   └── useQuery.ts     # Управление запросами
├── pages/              # Страницы приложения
│   ├── Upload.tsx      # Загрузка документов
│   ├── Documents.tsx   # Список документов
│   ├── DocumentDetail.tsx # Детали документа
│   └── Query.tsx       # Страница запросов
├── types/              # TypeScript типы
│   └── rag.ts         # Типы для RAG системы
└── lib/               # Утилиты
    └── utils.ts
```

## Ключевые компоненты

### API слой (`src/api/ragApi.ts`)
- Централизованное управление всеми API вызовами
- Функции: uploadPdf, getDocument, getAllDocuments, query, queryLlm
- Обработка загрузки файлов с прогрессом

### Хуки состояния

#### `useDocuments`
- Загрузка и управление списком документов
- Удаление документов
- Автоматическое обновление при загрузке

#### `useQuery`
- Выполнение запросов (vector + LLM)
- История запросов
- Управление текущим ответом

### Страницы

#### Upload
- Drag-n-drop загрузка
- Прогресс загрузки
- Редирект после успешной загрузки

#### Documents
- Список всех документов
- Карточки с метаданными
- Удаление и просмотр

#### DocumentDetail
- Просмотр всех чанков документа
- Поиск по чанкам
- Expandable детали

#### Query
- Интерфейс запросов
- Отображение результатов
- История запросов
- Визуализация source nodes

## Дизайн система

### Цветовая палитра
- **Primary**: Синий/голубой (#60A5FA) - основной акцент
- **Secondary**: Темно-синий - второстепенные элементы
- **Accent**: Фиолетовый - выделение важного
- **Background**: Темный фон (dark mode)
- **Success**: Зеленый - успешные операции

### Компоненты UI
Использует shadcn/ui компоненты:
- Card, Button, Input, Textarea
- Progress, Badge, ScrollArea
- Sidebar, Dialog, Toast

## Потоки данных

### Загрузка документа
1. Пользователь выбирает файл через drag-n-drop
2. `DocumentUpload` вызывает `ragApi.uploadPdf`
3. Отображается прогресс загрузки
4. После успеха - редирект на страницу документов
5. `useDocuments` автоматически обновляет список

### Выполнение запроса
1. Пользователь вводит запрос в `QueryInterface`
2. Выбирает режим (vector/LLM)
3. `useQuery.executeQuery` вызывает соответствующий API
4. `QueryResults` отображает ответ и source nodes
5. Запрос добавляется в историю

### Просмотр чанков
1. Клик на документ открывает `DocumentDetail`
2. Загружается полный документ через `ragApi.getDocument`
3. Отображаются все чанки с метаданными
4. Доступен поиск по тексту чанков

## Улучшения backend

### Рекомендации для API

1. **Pagination для документов и чанков**
   - Добавить параметры `limit` и `offset`
   - Возвращать total count

2. **Streaming для LLM ответов**
   - Server-Sent Events для real-time ответов
   - Улучшит UX для длинных генераций

3. **Метаданные чанков**
   - Добавить timestamp создания
   - Язык текста
   - Вектор эмбеддинга (для визуализации)

4. **Batch операции**
   - Загрузка нескольких файлов
   - Удаление нескольких документов

5. **Webhooks для статуса обработки**
   - Уведомления о завершении обработки
   - Статус каждого этапа pipeline

## Дополнительные фичи (реализованы)

1. ✅ **Визуализация релевантности**
   - Progress bar для каждого source node
   - Цветовая индикация (зеленый/синий/серый)

2. ✅ **Поиск по чанкам**
   - Highlight найденных слов
   - Фильтрация в реальном времени

3. ✅ **История запросов**
   - Сохранение всех запросов в сессии
   - Timestamp и количество источников

4. ✅ **Expandable контекст**
   - Сворачиваемые чанки
   - Показ метаданных по клику

5. ✅ **Статистика документов**
   - Количество чанков
   - Размер файла
   - Дата загрузки

## Будущие улучшения

1. **Граф знаний**
   - Визуализация связей между чанками
   - D3.js или React Flow

2. **Восстановление структуры PDF**
   - Показ оригинального layout
   - PDF.js viewer

3. **Экспорт результатов**
   - PDF отчет с ответами
   - Markdown export

4. **Collaborative features**
   - Поделиться запросом
   - Комментарии к чанкам

5. **Analytics dashboard**
   - Самые популярные запросы
   - Статистика использования
